IMPORTANT: Re-run the secrets migration!

The migration file has been updated to support per-organization secrets.

If you already ran the migration:
1. Either drop the tables and re-run:
   psql -d objecta-labs -c "DROP TABLE IF EXISTS secrets_rotation_history CASCADE;"
   psql -d objecta-labs -c "DROP TABLE IF EXISTS secrets_access_log CASCADE;"
   psql -d objecta-labs -c "DROP TABLE IF EXISTS secrets_vault CASCADE;"
   ./run-secrets-migration.sh

2. Or run this ALTER script:
   psql -d objecta-labs << 'SQL'
   -- Add new columns
   ALTER TABLE secrets_vault ADD COLUMN IF NOT EXISTS organization_id UUID REFERENCES organizations(id) ON DELETE CASCADE;
   ALTER TABLE secrets_vault ADD COLUMN IF NOT EXISTS is_platform_secret BOOLEAN DEFAULT false;
   
   -- Drop old unique constraint
   ALTER TABLE secrets_vault DROP CONSTRAINT IF EXISTS secrets_vault_key_key;
   
   -- Add new unique constraint
   ALTER TABLE secrets_vault ADD CONSTRAINT unique_platform_secret UNIQUE(key, organization_id, is_platform_secret);
   
   -- Update existing secrets to be platform secrets
   UPDATE secrets_vault SET is_platform_secret = true WHERE organization_id IS NULL;
   
   -- Add indexes
   CREATE INDEX IF NOT EXISTS idx_secrets_vault_org_id ON secrets_vault(organization_id) WHERE organization_id IS NOT NULL;
   CREATE INDEX IF NOT EXISTS idx_secrets_vault_platform ON secrets_vault(is_platform_secret) WHERE is_platform_secret = true;
   SQL

Then restart your backend server!
